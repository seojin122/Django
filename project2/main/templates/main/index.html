<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>학생 관리 대시보드</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    :root {
      --brand:#0d6efd;
      --paper:#f8fafc;
    }
    body { background: var(--paper); }
    .navbar-brand span { font-weight: 800; letter-spacing:.2px; }
    .brand-pill {
      display:inline-block; padding:.25rem .6rem; border-radius:50rem;
      background:rgba(13,110,253,.1); color:var(--brand); font-weight:600; font-size:.85rem;
    }
    .card { border:0; box-shadow:0 4px 18px rgba(2,8,20,.06); }
    .table thead th { position:sticky; top:0; background:#111827; color:#fff; z-index:1; }
    .table-hover tbody tr:hover { background:#f2f7ff; }
    .empty-state { padding:3rem 1rem; color:#6c757d; }
    .search-wrap { gap:.5rem; }
    .badge-soft { background:#eef2ff; color:#3b5bdb; border:1px solid #dbe4ff; }
    .footer-note { font-size:.85rem; color:#6c757d; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <i class="bi bi-mortarboard-fill me-2"></i>
        <span>WithCampus</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarsExample">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="#"><i class="bi bi-speedometer2 me-1"></i>대시보드</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'main:student_add' %}"><i class="bi bi-person-plus me-1"></i>학생 등록</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <header class="py-5 bg-white border-bottom">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-7">
          <h1 class="display-6 fw-bold mb-2">학생 관리 대시보드</h1>
          <p class="text-muted mb-3">등록된 학생 현황을 한눈에. 검색, 내보내기까지 비즈니스급 UI로 깔끔하게 관리하세요.</p>
          <span class="brand-pill"><i class="bi bi-stars me-1"></i>Business-ready</span>
        </div>
        <div class="col-lg-5 text-lg-end mt-3 mt-lg-0">
          <a href="{% url 'main:student_add' %}" class="btn btn-primary btn-lg">
            <i class="bi bi-person-plus-fill me-1"></i>새 학생 등록
          </a>
        </div>
      </div>
    </div>
  </header>

  <main class="container my-5">
    <div class="card mb-4">
      <div class="card-body d-flex flex-wrap justify-content-between align-items-center">
        <div class="d-flex search-wrap align-items-center">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input id="tableSearch" type="search" class="form-control" placeholder="이름·학과·학번으로 검색" />
          </div>
          <button id="clearSearch" class="btn btn-outline-secondary"><i class="bi bi-x-circle"></i></button>
        </div>
        <div class="d-flex gap-2">
          <button id="exportCSV" class="btn btn-outline-primary"><i class="bi bi-filetype-csv me-1"></i>CSV 내보내기</button>
          <button id="refreshBtn" class="btn btn-outline-secondary"><i class="bi bi-arrow-clockwise me-1"></i>새로고침</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
        <div><i class="bi bi-table me-2"></i>등록된 학생 목록</div>
        <span class="badge badge-soft" id="rowCount">0명</span>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover table-bordered align-middle mb-0" id="studentTable">
            <thead>
              <tr>
                <th scope="col" style="min-width:140px">이름</th>
                <th scope="col" style="min-width:180px">학과</th>
                <th scope="col" style="min-width:160px">학번</th>
              </tr>
            </thead>
            <tbody>
              {% for s in students %}
              <tr>
                <td>{{ s.name }}</td>
                <td>{{ s.department }}</td>
                <td>{{ s.student_id }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="3" class="text-center empty-state">
                  <i class="bi bi-inboxes me-2"></i>등록된 학생이 없습니다. 상단의 <b>새 학생 등록</b>을 눌러 추가해 보세요.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="card-footer text-end footer-note">
        데이터는 실시간으로 서버에서 제공됩니다.
      </div>
    </div>
  </main>

  <footer class="py-4 border-top bg-white">
    <div class="container d-flex justify-content-between flex-wrap gap-2">
      <span class="text-muted">© 2025 WithCampus • Student Ops</span>
      <div class="text-muted">Made with <i class="bi bi-heart-fill"></i> & Bootstrap 5</div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const q = document.getElementById('tableSearch');
    const clearBtn = document.getElementById('clearSearch');
    const table = document.getElementById('studentTable');
    const rows = () => Array.from(table.querySelectorAll('tbody tr'));
    const rowCountBadge = document.getElementById('rowCount');

    function applyFilter() {
      const term = q.value.trim().toLowerCase();
      let visible = 0;
      rows().forEach(tr => {
        const text = tr.innerText.toLowerCase();
        const show = term === '' || text.includes(term);
        tr.style.display = show ? '' : 'none';
        if (show && tr.querySelectorAll('td').length) visible++;
      });
      rowCountBadge.textContent = visible + '명';
    }
    q?.addEventListener('input', applyFilter);
    clearBtn?.addEventListener('click', () => { q.value=''; applyFilter(); q.focus(); });
    document.getElementById('refreshBtn')?.addEventListener('click', () => { location.reload(); });

    function toCSV() {
      const lines = [];
      const header = Array.from(table.tHead.rows[0].cells).map(th => th.innerText.trim());
      lines.push(header.join(','));
      rows().forEach(tr => {
        if (tr.style.display === 'none') return;
        const cells = Array.from(tr.cells).map(td => '"' + td.innerText.trim().replaceAll('"','""') + '"');
        if (cells.length) lines.push(cells.join(','));
      });
      return lines.join('\n');
    }
    document.getElementById('exportCSV')?.addEventListener('click', () => {
      const blob = new Blob([toCSV()], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'students.csv';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    applyFilter();
  </script>
</body>
</html>
